---
subtitle: "GROW UC Merced 2020"
author: "Andrea SÃ¡nchez-Tapia"
date: "25th August 2020"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
---
class: middle, center
## manipulating and analyzing data with __dplyr__

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```

```{r xaringanthemer, include = FALSE}
library(xaringanthemer)
xaringanthemer::style_mono_accent(
  base_color = "#A70000",
  #  primary_color = "#A70000",
  #secondary_color = "#ff0000",
  white_color = "white",
  colors = c(
    red = "#A70000",
    purple = "#88398a",
    orange = "#ff8811",
    green = "#136f63",
    blue = "#4B4FFF",
    white = "#FFFFFF",
    black = "#181818"
  ),
  header_font_google = google_font("Roboto Condensed"),
  text_font_google   = google_font("Roboto Condensed", "300", "300i"),
  code_font_google   = google_font("Ubuntu Mono"),
  text_font_size = "30px",
  code_font_size = "30px",
  )
```

---
background-image: url("https://d33wubrfki0l68.cloudfront.net/621a9c8c5d7b47c4b6d72e8f01f28d14310e8370/193fc/css/images/hex/dplyr.png")
background-position: 98% 2%
background-size: 150px

## the tidyverse: an "umbrella" package

--

+ __ggplot2__: a "grammar of graphics" by Hadley Wickham. Divide the data and the <br> aesthetics. Create and modify the plots layer by layer

--

+ __dplyr__: a way to lead with data frames, sql external data bases, written in `C++`

--

+ __readr__: read data
--

+ __tidyr__: format data frames

--

+ __stringr__: deals with strings
--

+ additional packages for other tasks: __tibble__, __lubridate__ and many more

Most of R is still __base__-based and both philosophies communicate well with each other

---
## reading data with __readr__

```{r dplyr, message=FALSE}
library(dplyr)
library(readr)
```

--

```{r remedy001}
surveys <- read_csv("data_raw/portal_data_joined.csv")
```

---

```{r remedy002}

## inspect the data
str(surveys)

```

---

```{r remedy003, eval = FALSE}

View(surveys)

```

```{r remedy004}
surveys
```

---

## some principal functions in __dplyr__

+ __select__ (columns)

--

+ __filter__ (rows)

--

+ __rename__ (columns)

--

+ __mutate__ (create new columns or modify existing columns)

--

+ __arrange__ to sort according to a column

--

+ __count__ cases of one or many columns

---
## select

```{r remedy005,results='hide'}

select(surveys, plot_id, species_id, weight)
```

--

1. there is no need to put quotes
2. there is no need to put variables between `c()`

--

#### base R still works in a tibble

```{r remedy006, results='hide'}
surveys[, c("plot_id", "species_id", "weight")]
```

---
## removing columns

```{r remedy007}
select(surveys, -record_id, -species_id)
```

---
## additional functions

```{r remedy008}
select(surveys, ends_with("id"))
```

---
## filter rows

__logical clauses!__ 

```{r remedy009, results = "hide"}
surveys$year == 1995
surveys[surveys$year == 1995 , ]
```

```{r remedy010, results='hide'}
surv_1995 <- filter(surveys, year == 1995)
```

#### No need to use $ or brackets

---
## mutate

```{r remedy011, results = "hide"}
surveys <- mutate(surveys, weight_kg = weight / 1000)
```

```{r remedy012}

mutate(surveys,
       weight_kg = weight / 1000,
       weight_lb = weight_kg * 2.2)

```

---
## `group_by()` and `summarise()`

+ if you have a column factor (e.g. sex) and want to apply a function to the levels of this factor

```{r remedy013}
surveys_g <-group_by(surveys, sex) #does nothing?
summary_sex <- summarize(surveys_g, 
                         mean_weight = mean(weight, na.rm = TRUE))
summary_sex
```

---
## another example: 

```{r remedy014}
surveys_g2 <-group_by(surveys, sex, species_id)
mean_w <- summarize(surveys_g2, 
                    mean_weight = mean(weight, na.rm = TRUE))
```


---

```{r remedy015}
mean_w

```
---
## arrange

```{r arraange}
arrange(mean_w, mean_weight)
```

---
## count

```{r}
surveys %>%
    count(sex)
```

---
background-image: url("https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse1.mm.bing.net%2Fth%3Fid%3DOIP.kBwKFkkvi_Ye6osZkQrjnwAAAA%26pid%3DApi&f=1")
background-position: 98% 2%
background-size: 150px
# the pipe operator

Classic syntax goes with `<-`

```r
object1
object2 <- function1(object1)
object3 <- function2(object2)
```

The pipe operator allows the programming to nest the results:

```r
object3 <- object1 %>% function1() %>% function2()
```

### many of these functions work very well with pipes
